---
title: "volatility trading"
format: html
editor: visual
---

```{r}
library(tidyverse)
library(tidyquant)
library(quantmod)
library(plotly)
```

## Implied Volatility

RATIONALE:

In general, the more volatile an investment, the more likely that investment is to experience uncertainty, swings in value, etc.

If two or more firms exist in the same industry, have similar cash flows, and own similar assets, they should be exposed to similar market conditions and therefore have similar volatilities. If for some reason they don't, there should be an arbitrage opportunity.

Assume that volatility inherently makes an investment, ceterus paribus, less valuable.

To try it out, compare the volatilities of Delta Airlines, United Airlines, and American Airlines by using call options, in and out of the money, and compare the smiles.

```{r}
today = "2024-01-12"
dl <- tidyquant::tq_get("DAL", get = "stock.prices", from = today) %>% 
  dplyr::select(adjusted)
dlcp <- dl$adjusted
ua <- tidyquant::tq_get("UAL", get = "stock.prices", from = today) %>% 
  dplyr::select(adjusted)
uacp <- ua$adjusted
aa <- tidyquant::tq_get("AAL", get = "stock.prices", from = today) %>% 
  dplyr::select(adjusted)
aacp <- aa$adjusted

dl <- quantmod::getOptionChain("DAL", src = "yahoo")
ua <- quantmod::getOptionChain("UAL", src = "yahoo")
aa <- quantmod::getOptionChain("AAL", src = "yahoo")
delta <- dl[["calls"]] %>% 
  dplyr::mutate(Ticker = stringr::str_extract(ContractID, "^.{3}"), Diff = (Strike - dlcp)/dlcp) %>% 
  dplyr::select(Ticker, Expiration, Strike, Vol, OI, IV, ITM, Diff)
united <- ua[["calls"]] %>% 
  dplyr::mutate(Ticker = stringr::str_extract(ContractID, "^.{3}"), Diff = (Strike - uacp)/uacp) %>% 
  dplyr::select(Ticker, Expiration, Strike, Vol, OI, IV, ITM, Diff)
american <- aa[["calls"]] %>% 
  dplyr::mutate(Ticker = stringr::str_extract(ContractID, "^.{3}"), Diff = (Strike - aacp)/aacp) %>%  
  dplyr::select(Ticker, Expiration, Strike, Vol, OI, IV, ITM, Diff)

calls <- rbind(delta, united, american) %>% 
  dplyr::filter(Diff > -0.15 & Diff < 0.15) %>%
  ggplot(aes(x = Diff, y = IV, color = Ticker)) +
  geom_line()
ggplotly(calls)
```
